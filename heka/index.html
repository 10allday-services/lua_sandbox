<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="/lua_sandbox/docs.css" type="text/css" />
</head>
<body>
<div id="title">Lua Sandbox Library (0.20.1)<hr/></div>
<div class="menu">
        <ul>
            <li><a href="/lua_sandbox/index.html">Overview</a></li>
        </ul>
        <ul>
            <li><a href="/lua_sandbox/sandbox.html">Generic Sandbox</a></li>
        </ul>
        <ul>
            <li><a href="/lua_sandbox/heka/index.html">Heka Sandbox</a></li>
        <ul>
            <li><a href="/lua_sandbox/heka/analysis.html">Analysis Interface</a></li>
            <li><a href="/lua_sandbox/heka/input.html">Input Interface</a></li>
            <li><a href="/lua_sandbox/heka/output.html">Output Interface</a></li>
        </ul>
        </ul>
        <ul>
           <li><a href="/lua_sandbox/cli/index.html">Command Line Tools</a></li>
        </ul>
        <ul>
            <li><a href="/lua_sandbox/doxygen/index.html">Source Documentation</a></li>
        </ul>
        <ul>
            <li>C Modules</li>
            <ul>
                <li><a href="https://github.com/mozilla-services/lua_bloom_filter/blob/master/README.md">bloom_filter</a></li>
                <li><a href="https://github.com/mozilla-services/lua_circular_buffer/blob/master/README.md">circular_buffer</a></li>
                <li><a href="http://www.kyne.com.au/~mark/software/lua-cjson-manual.html">cjson</a></li>
                <li><a href="https://github.com/mozilla-services/lua_cuckoo_filter/blob/master/README.md">cuckoo_filter</a></li>
                <li><a href="https://github.com/mozilla-services/lua_hyperloglog/blob/master/README.md">hyperloglog</a></li>
                <li><a href="http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html">lpeg</a></li>
                <li><a href="http://www.inf.puc-rio.br/~roberto/lpeg/re.html">re</a></li>
                <li><a href="https://github.com/trink/symtseries/blob/master/README.md">sax</a></li>
                <li><a href="http://www.inf.puc-rio.br/~roberto/struct/">struct</a></li>
            </ul>
        </ul>
        <ul>
<li><a href="/lua_sandbox/modules/index.html">modules</a></li>
<ul>
<li><a href="/lua_sandbox/modules/heka/index.html">heka</a></li>
<ul>
<li><a href="/lua_sandbox/modules/heka/elasticsearch/index.html">elasticsearch</a></li>
<ul>
<li><a href="/lua_sandbox/modules/heka/elasticsearch/payload.html">payload</a></li>
</ul>
<li><a href="/lua_sandbox/modules/heka/elasticsearch.html">elasticsearch</a></li>
<li><a href="/lua_sandbox/modules/heka/msg_interpolate.html">msg_interpolate</a></li>
<li><a href="/lua_sandbox/modules/heka/util.html">util</a></li>
</ul>
<li><a href="/lua_sandbox/modules/lpeg/index.html">lpeg</a></li>
<ul>
<li><a href="/lua_sandbox/modules/lpeg/cbufd.html">cbufd</a></li>
<li><a href="/lua_sandbox/modules/lpeg/common_log_format.html">common_log_format</a></li>
<li><a href="/lua_sandbox/modules/lpeg/date_time.html">date_time</a></li>
<li><a href="/lua_sandbox/modules/lpeg/ip_address.html">ip_address</a></li>
<li><a href="/lua_sandbox/modules/lpeg/mysql.html">mysql</a></li>
<li><a href="/lua_sandbox/modules/lpeg/postfix.html">postfix</a></li>
<li><a href="/lua_sandbox/modules/lpeg/syslog.html">syslog</a></li>
<li><a href="/lua_sandbox/modules/lpeg/syslog_message.html">syslog_message</a></li>
</ul>
<li><a href="/lua_sandbox/modules/lsb/index.html">lsb</a></li>
<ul>
<li><a href="/lua_sandbox/modules/lsb/util.html">util</a></li>
</ul>
</ul>
</ul>
<ul>
<li><a href="/lua_sandbox/sandboxes/index.html">sandboxes</a></li>
<ul>
<li><a href="/lua_sandbox/sandboxes/heka/index.html">heka</a></li>
<ul>
<li><a href="/lua_sandbox/sandboxes/heka/analysis/index.html">analysis</a></li>
<ul>
<li><a href="/lua_sandbox/sandboxes/heka/analysis/throughput.html">throughput</a></li>
</ul>
<li><a href="/lua_sandbox/sandboxes/heka/input/index.html">input</a></li>
<ul>
<li><a href="/lua_sandbox/sandboxes/heka/input/heka_kafka.html">heka_kafka</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/input/heka_stdin.html">heka_stdin</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/input/heka_tcp.html">heka_tcp</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/input/syslog_udp.html">syslog_udp</a></li>
</ul>
<li><a href="/lua_sandbox/sandboxes/heka/output/index.html">output</a></li>
<ul>
<li><a href="/lua_sandbox/sandboxes/heka/output/debug.html">debug</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/elasticsearch_bulk_api.html">elasticsearch_bulk_api</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/heka_kafka.html">heka_kafka</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/heka_log_rolling.html">heka_log_rolling</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/heka_s3_partition.html">heka_s3_partition</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/heka_tcp.html">heka_tcp</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/heka_tcp_matcher.html">heka_tcp_matcher</a></li>
<li><a href="/lua_sandbox/sandboxes/heka/output/inject_payload.html">inject_payload</a></li>
</ul>
</ul>
</ul>
</ul>
    </div>
    <div class="main-content">
<h1 id="heka-sandbox-interface">Heka Sandbox Interface</h1>
<h2 id="overview">Overview</h2>
<p>This document describes the pending 1.0 release of the Heka sandbox API built on the <a href="../sandbox.html">Generic Sandbox Interface</a>. The 1.0 release is a refined implementation of its predecessor which was developed in <a href="https://github.com/mozilla-services/heka">Heka</a>. The goal is to decople it from Go and make it easily embeddable in any language. We are in the process of porting it back to the Heka Go implementation but a new design of that infrastructure has been created to replace it called <a href="https://github.com/trink/hindsight">Hindsight</a>.</p>
<h2 id="sandbox-api-changes-from-the-go-heka-sandbox">Sandbox API Changes from the Go Heka Sandbox</h2>
<p>There are a few intentional changes between tho original Heka sandbox and this version.</p>
<h3 id="changes">Changes</h3>
<h4 id="input-sandbox">Input Sandbox</h4>
<ol>
<li><code>inject_message</code> accepts a numeric or string checkpoint as the second argument</li>
<li><code>process_message</code> receives the checkpoint value as the first argument (if it was provided by <code>inject_message</code>).</li>
</ol>
<h4 id="output-sandbox">Output Sandbox</h4>
<ol>
<li><code>process_message</code> receives a sequence_id as the first argument (if it was provided by <code>update_checkpoint</code>). Extended return codes have been added to support skipping, retrying, batching, and asynchronous output.</li>
</ol>
<h4 id="analysisoutput-sandbox">Analysis/Output Sandbox</h4>
<ol>
<li><code>read_message</code>
<ul>
<li>returns <code>nil</code> for optional header fields if they don't exist instead of an empty string or zero</li>
<li>added a <code>framed</code> parameter to retrive the raw message with stream framing</li>
<li>added a <code>size</code> parameter to retrive size of the raw message without having to copy it down</li>
</ul></li>
<li><code>timer_event</code> has a second parameter <code>shutdown</code> that is set to true when the sandbox is exiting.</li>
</ol>
<h3 id="additions">Additions</h3>
<h4 id="input-sandbox-1">Input Sandbox</h4>
<ol>
<li>A <a href="stream_reader.html">Heka Stream Reader</a> Lua module was added.</li>
<li>A <a href="heka_json.html">Heka JSON</a> Lua module was added.</li>
</ol>
<h4 id="output-sandbox-1">Output Sandbox</h4>
<ol>
<li><a href="output.html#update_checkpoint">update_checkpoint</a> was added for batch and asynchronous processing.</li>
<li>A <a href="heka_json.html">Heka JSON</a> Lua module was added.</li>
</ol>
<h3 id="removals">Removals</h3>
<ol>
<li>The <code>write_message</code> API was removed; messages are immutable and this API broke that rule.</li>
<li>The <code>read_next_field</code> API was removed; instead the raw message should be decoded and the Lua table iterated.</li>
</ol>
<h3 id="notes">Notes</h3>
<ol>
<li>The <code>read_config</code> API in unchanged but now has access to the entire sandbox configuration.</li>
</ol>
</div>
</body>
</html>
